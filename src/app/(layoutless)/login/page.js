import React from "react";
import Login from "@/components/templates/Login-Register/Login/Login";
import userModel from "@/root/models/User";
import { redirect } from "next/navigation";
import connectToDB from "@/root/configs/db";
import { verifyAccessToken } from "@/root/util/auth/auth";
import { cookies } from "next/headers";

export const metadata = {
  title: 'صفحه ورود',
  description: 'Generated by Next.js',
}

export default async function page() {
  let user = null;
  connectToDB();
  const token = cookies().get("token");
  if (token) {
    const tokenPayLoad = verifyAccessToken(token.value);
    console.log("t",tokenPayLoad)
    if (tokenPayLoad) {
      user = await userModel.findOne({ phoneNumber: tokenPayLoad.phoneNumber });
      console.log("u",user)
      if(user){
        redirect('/')
      }
    }
  }
  return (
    <div className="relative w-full h-dvh  flex">
      <img src="/img/login.jpg" className="w-full h-full" alt="login image" />
      <div className="absolute w-1/2 left-0">
        <div className="relative  h-dvh bg-black opacity-50 ">
        </div>
          <Login />
      </div>
    </div>
  );
}
